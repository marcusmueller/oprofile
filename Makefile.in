# $Id: Makefile.in,v 1.38 2001/11/10 13:16:15 movement Exp $

BKCFLAGS=@BKCFLAGS@ @MODVERSIONS@
MKDIR_P=mkdir -p
CC=@CC@
LD=@LD@

.PHONY: all install clean distclean maintainerclean uninstall tags

all:
	$(MAKE) -C module
	$(MAKE) -C dae
	$(MAKE) -C pp
	$(MAKE) -C gui

install: install.kernel install.user

install.kernel: all
	$(MAKE) -C module install DESTDIR=$(DESTDIR)

install.user: all
	$(MAKE) -C dae install DESTDIR=$(DESTDIR)
	$(MAKE) -C pp install DESTDIR=$(DESTDIR)
	$(MAKE) -C doc install DESTDIR=$(DESTDIR)
	$(MAKE) -C gui install DESTDIR=$(DESTDIR)

uninstall:
	$(MAKE) -C module uninstall
	$(MAKE) -C dae uninstall
	$(MAKE) -C pp uninstall
	$(MAKE) -C doc uninstall
	$(MAKE) -C gui uninstall
	@echo "Goodbye."

clean:
	rm -f *.o
	$(MAKE) -C module clean
	$(MAKE) -C dae clean
	$(MAKE) -C pp clean
	$(MAKE) -C doc clean
	$(MAKE) -C gui clean
 
# doc/Makefile is deleted here but should be deleted in distclean.
# When the dist target works move it as action of distclean.
maintainerclean: distclean
	rm -f configure doc/Makefile aclocal.m4

distclean: clean
	rm -f Makefile doc/oprofile.1 dae/Makefile pp/Makefile gui/Makefile tags config.status config.log config.cache version.h

tags:
	ctags -R

# broken 
# dist check list:
# 1. make dist (with doopr) 
# 2. upload to sf
# 3. untar into webpage
# 4. add release
# 5. close fixed bugs
# 6. send release email
# 7. update freshmeat
dist:
	mkdir tmpdist ; \
	cd tmpdist ; \
	cvs checkout oprofile ; \
	cd oprofile ; \
	(find -type d -name CVS | xargs rm -rf) ; \
	./autogen.sh ; \
	./configure ; \
	cp doc/Makefile doc/Makefile.tmp ; \
	make distclean ; \
	cd doc && make -f Makefile.tmp && rm -f Makefile.tmp && cd .. ; \
	cd .. ; \
	mv oprofile oprofile-@VERSION@ ; \
	tar cvfz ../oprofile-@VERSION@.tar.gz oprofile-@VERSION@ ; \
	rm -rf oprofile-@VERSION@ ; \
	cd ..  ; \
	rm -rf tmpdist \

